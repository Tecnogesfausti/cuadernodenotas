<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Menu Evaluaciones</title>
  <style>
    body { font: normal 10pt Verdana, Arial, sans-serif; margin: 14px; }
    .panel { border: 1px solid #d7d7d7; background: #fff; padding: 12px; margin-bottom: 12px; }
    .muted { color: #666; }
    label { margin-right: 6px; }
    select { padding: 5px; margin-right: 10px; }
    .btn {
      border: 1px solid #0b63c9;
      color: #fff;
      background: #0b63c9;
      padding: 6px 10px;
      text-decoration: none;
      border-radius: 3px;
      font-size: 12px;
      cursor: pointer;
    }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    tr:nth-child(even) { background: #fafafa; }
  </style>
</head>
<body>
  <div class="panel">
    <h2 style="margin:0 0 6px;">Evaluaciones</h2>
    {% if latest_importacion %}
      <div class="muted">Importacion activa: {{ latest_importacion.id }} ({{ latest_importacion.curso }})</div>
    {% else %}
      <div class="muted">No hay importaciones disponibles.</div>
    {% endif %}
  </div>

  <div class="panel">
    <form method="get" action="/evaluaciones/">
      <label for="grupo_id">Grupo</label>
      <select name="grupo_id" id="grupo_id" required>
        <option value="">Selecciona grupo</option>
        {% for grupo in grupos %}
          <option value="{{ grupo.id }}" {% if grupo_id == grupo.id %}selected{% endif %}>{{ grupo.grupo }}</option>
        {% endfor %}
      </select>

      <label for="trimestre">Trimestre</label>
      <select name="trimestre" id="trimestre">
        <option value="1" {% if trimestre == 1 %}selected{% endif %}>1</option>
        <option value="2" {% if trimestre == 2 %}selected{% endif %}>2</option>
        <option value="3" {% if trimestre == 3 %}selected{% endif %}>3</option>
      </select>

      <button class="btn" type="submit">Ver asignaturas</button>
    </form>
  </div>

  {% if grupo_sel %}
    <div class="panel">
      <h3 style="margin-top:0;">Grupo: {{ grupo_sel.grupo }} | Trimestre: {{ trimestre }}</h3>
      {% if asignaturas %}
        <table>
          <thead>
            <tr>
              <th>Asignatura</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for asignatura in asignaturas %}
              <tr>
                <td>{{ asignatura.nombre }}</td>
                <td>
                  <a class="btn" href="/evaluaciones/visitaasignatura/{{ asignatura.id }}/{{ trimestre }}/0/?grupo_id={{ grupo_sel.id }}">Ver tabla</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="muted">No hay asignaturas con datos para este grupo y trimestre.</p>
      {% endif %}
    </div>
  {% endif %}
</body>
</html>
